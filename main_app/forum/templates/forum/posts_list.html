{% extends "forum/base.html" %}

{% block title %}
    <title>{{topic.name}}</title>
{% endblock %}

{% block content %}
    {% block menu_forum %}
        {{block.super}}
    {% endblock menu_forum %}

    <h2>{{topic}}</h2>
    {% for post in page_obj %}
    <p><a href="{{post.author.get_absolute_url}}">{{post.author}}</a></p>
        <p>{{post.time_create}}</p>
        {% if post.is_changed_text %}
            <p>Изменено: {{post.time_update_text}}</p>
        {% endif %}
        <p>Оценка: {{post.score}}</p>
        {% if user.is_authenticated %}
        <p>
            <form action="{% url 'rate_post' post.pk %}" method="post">
            {% csrf_token %}
            {{ rate_form.as_p }}
            <input type="submit" value="Оценить">
            </form>
        </p>
        {% endif %}
        <p>{{post.text}}</p>
        {% if user.id == post.author.id and post.post_type != 0 and post.is_editable %}
            <p><a href="{% url 'update_post' post.pk %}">Редактировать сообщение</a></p>
        {% endif %}
        <br>
    {% endfor %}
    {% block pagination %}
        {{block.super}}
    {% endblock pagination %}
    {% if user.is_authenticated %}
        <form action="{% url 'topic' topic.slug %}" method="post">
            {% csrf_token %}
            <ul>
                {{form.as_ul}}
                <li>
                    <button type="submit">Создать сообщение</button>
                </li>
            </ul>
        </form>
    {% else %}
        <h3>Только зарегестрированные пользователи могут оставлять сообщения.</h3>
    {% endif %}
{% endblock content %}